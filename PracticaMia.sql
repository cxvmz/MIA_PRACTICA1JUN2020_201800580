/* 
INCISO1
*/

CREATE TABLE PROFESION(
    cod_profesion INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL ,
    CONSTRAINT PROFESION_unique_nombre UNIQUE (nombre)
);

CREATE TABLE PAIS(
    cod_pais INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL UNIQUE,
    CONSTRAINT PAIS_unique_nombre UNIQUE (nombre)
);

CREATE TABLE PUESTO(
    cod_puesto INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    CONSTRAINT PUESTO_unique_nombre UNIQUE (nombre)
);

CREATE TABLE DEPARTAMENTO(
    cod_departamento INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    CONSTRAINT DEPARTAMENTO_unique_nombre UNIQUE(nombre)
);

CREATE TABLE MIEMBRO(
    cod_miembro INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    edad INTEGER NOT NULL,
    telefono INTEGER,
    residencia VARCHAR(100),
    PAIS_cod_pais INTEGER NOT NULL,
    PROFESION_cod_profesion INTEGER NOT NULL,
    CONSTRAINT MIEMBRO_FK_pais FOREIGN KEY (PAIS_cod_pais) REFERENCES PAIS(cod_pais) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT MIEMBRO_FK_prof FOREIGN KEY (PROFESION_cod_profesion) REFERENCES PROFESION(cod_profesion) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE PUESTO_MIEMBRO(
    MIEMBRO_cod_miembro INTEGER NOT NULL,
    PUESTO_cod_puesto INTEGER NOT NULL,
    DEPARTAMENTO_cod_departamento INTEGER NOT NULL,
    fecha_inicio DATE NOT NULL,
    fecha_fin DATE,
    CONSTRAINT PK_PUESTO_MIEMBRO PRIMARY KEY (MIEMBRO_cod_miembro, PUESTO_cod_puesto, DEPARTAMENTO_cod_depto),
    CONSTRAINT PUESTO_MIEMBRO_FK_miembro FOREIGN KEY (MIEMBRO_cod_miembro) REFERENCES MIEMBRO(cod_miembro) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT PUESTO_MIEMBRO_FK_puesto FOREIGN KEY (PUESTO_cod_puesto) REFERENCES PUESTO(cod_puesto) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT PUESTO_MIEMBRO_FK_departamento FOREIGN KEY (DEPARTAMENTO_cod_departamento) REFERENCES DEPARTAMENTO(cod_departamento) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE TIPO_MEDALLA(
    cod_tipo INTEGER NOT NULL PRIMARY KEY,
    medalla VARCHAR(20),
    CONSTRAINT TIPO_MEDALLA_unique_medalla UNIQUE (medalla)
);

CREATE TABLE MEDALLERO(
    PAIS_cod_pais INTEGER NOT NULL,
    cantidad_medallas INTEGER NOT NULL,
    TIPO_MEDALLA_cod_tipo INTEGER NOT NULL,
    CONSTRAINT PK_MEDALLERO PRIMARY KEY (PAIS_cod_pais, TIPO_MEDALLA_cod_tipo),
    CONSTRAINT MEDALLERO_FK_pais FOREIGN KEY (PAIS_cod_pais) REFERENCES PAIS(cod_pais) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT MEDALLERO_FK_tipo_medalla FOREIGN KEY (TIPO_MEDALLA_cod_tipo) REFERENCES TIPO_MEDALLA(cod_tipo) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE DISCIPLINA(
    cod_disciplina INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    descripcion VARCHAR(150)
);

CREATE TABLE ATLETA(
    cod_atleta INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellido VARCHAR(50) NOT NULL,
    edad INTEGER NOT NULL,
    participaciones VARCHAR(100) NOT NULL,
    DISCIPLINA_cod_disciplina INTEGER NOT NULL,
    PAIS_cod_pais INTEGER NOT NULL,
    CONSTRAINT ATLETA_FK_pais FOREIGN KEY (PAIS_cod_pais) REFERENCES PAIS(cod_pais) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ATLETA_FK_disciplina FOREIGN KEY (DISCIPLINA_cod_disciplina) REFERENCES DISCIPLINA(cod_disciplina) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE CATEGORIA(
    cod_categoria INTEGER NOT NULL PRIMARY KEY,
    categoria VARCHAR(50) NOT NULL
);

CREATE TABLE TIPO_PARTICIPACION(
    cod_participacion INTEGER NOT NULL PRIMARY KEY,
    tipo_participacion VARCHAR(100) NOT NULL
);

CREATE TABLE EVENTO(
    cod_evento INTEGER NOT NULL PRIMARY KEY,
    fecha DATE NOT NULL,
    ubicacion VARCHAR(50) NOT NULL,
    hora DATE NOT NULL,
    DISCIPLINA_cod_disciplina INTEGER NOT NULL,
    TIPO_PARTICIPACION_cod_participacion INTEGER NOT NULL,
    CATEGORIA_cod_categoria INTEGER NOT NULL,
    CONSTRAINT EVENTO_FK_disciplina FOREIGN KEY (DISCIPLINA_cod_disciplina) REFERENCES DISCIPLINA(cod_disciplina) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT EVENTO_FK_tipo_participacion FOREIGN KEY (TIPO_PARTICIPACION_cod_participacion) REFERENCES TIPO_PARTICIPACION(cod_participacion) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT EVENTO_FK_categoria FOREIGN KEY (CATEGORIA_cod_categoria) REFERENCES CATEGORIA(cod_categoria) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE EVENTO_ATLETA(
    ATLETA_cod_atleta INTEGER NOT NULL,
    EVENTO_cod_evento INTEGER NOT NULL,
    CONSTRAINT PK_EVENTO_ATLETA PRIMARY KEY (ATLETA_cod_atleta, EVENTO_cod_evento),
    CONSTRAINT EVENTO_ATLETA_FK_atleta FOREIGN KEY (ATLETA_cod_atleta) REFERENCES ATLETA(cod_atleta) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT EVENTO_ATLETA_FK_evento FOREIGN KEY (EVENTO_cod_evento) REFERENCES EVENTO(cod_evento) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE TELEVISORA(
    cod_televisora INTEGER NOT NULL PRIMARY KEY,
    nombre VARCHAR(50)
);

CREATE TABLE COSTO_EVENTO(
    EVENTO_cod_evento INTEGER NOT NULL,
    TELEVISORA_cod_televisora INTEGER NOT NULL,
    tarifa NUMERIC NOT NULL,
    CONSTRAINT PK_COSTO_EVENTO PRIMARY KEY (EVENTO_cod_evento, TELEVISORA_cod_televisora),
    CONSTRAINT COSTO_EVENTO_FK_evento FOREIGN KEY (EVENTO_cod_evento) REFERENCES EVENTO(cod_evento) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT COSTO_EVENTO_FK_televisora FOREIGN KEY (TELEVISORA_cod_televisora) REFERENCES TELEVISORA(cod_televisora) ON DELETE CASCADE ON UPDATE CASCADE
);

/*
INCISO 2
*/
ALTER TABLE EVENTO DROP fecha;
ALTER TABLE EVENTO DROP hora;
ALTER TABLE EVENTO ADD fecha_hora DATE;

/*
INCISO 3
*/
ALTER TABLE EVENTO ADD CONSTRAINT check_date_hour 
    CHECK (fecha_hora BETWEEN   '2020-07-24 9:00:00' AND '2020-08-09 20:00:00');

/*
INCISO 4
*/
CREATE TABLE SEDE(
    codigo INTEGER NOT NULL PRIMARY KEY,
    sede VARCHAR(50) NOT NULL
);

ALTER TABLE EVENTO 
    ALTER COLUMN ubicacion SET DATA TYPE INTEGER USING ubicacion::INTEGER,
    ALTER COLUMN ubicacion SET NOT NULL,        
    ADD CONSTRAINT FK_SEDE FOREIGN KEY (ubicacion) REFERENCES SEDE(codigo) ON DELETE CASCADE ON UPDATE CASCADE;    

/*
INCISO 5
*/
ALTER TABLE MIEMBRO
    ALTER telefono SET DEFAULT 0;        

/*
INCISO 6
*/

INSERT INTO PAIS VALUES(1, 'Guatemala');
INSERT INTO PAIS VALUES(2, 'Francia');
INSERT INTO PAIS VALUES(3, 'Argentina');
INSERT INTO PAIS VALUES(4, 'Alemania');
INSERT INTO PAIS VALUES(5, 'Italia');
INSERT INTO PAIS VALUES(6, 'Brasil');
INSERT INTO PAIS VALUES(7, 'Estados Unidos');

SELECT * FROM PAIS;

INSERT INTO PROFESION VALUES(1, 'Medico');
INSERT INTO PROFESION VALUES(2, 'Arquitecto');
INSERT INTO PROFESION VALUES(3, 'Ingeniero');
INSERT INTO PROFESION VALUES(4, 'Secretaria');
INSERT INTO PROFESION VALUES(5, 'Auditor');


INSERT INTO MIEMBRO (cod_miembro, nombre,apellido,edad,residencia,PAIS_cod_pais, PROFESION_cod_profesion) 
VALUES(1, 'Scott', 'Mitchell', 32, '1092 Highland Drive Manitowoc, WI 54220', 7, 3);

INSERT INTO MIEMBRO VALUES(2, 'Fanette', 'Poulin', 25, 25075853, '49, boulevard Aristide Briand 76120 LE GRAND-QUEVILLY', 2, 4);

INSERT INTO MIEMBRO (cod_miembro, nombre, apellido, edad, residencia, PAIS_cod_pais, PROFESION_cod_profesion) 
VALUES(3, 'Laura', 'Cunha Silva', 55, 'Rua Onze, 86 UberabaMG ', 6, 5);

INSERT INTO MIEMBRO VALUES(4, 'Juan José', 'López',38,36985247, '26 calle 4-10 zona 11', 1, 2);

INSERT INTO MIEMBRO VALUES(5, 'Arcangela','Panicucci',39, 391664921,'Via Santa Teresa, 114 90010-Geraci Siculo PA', 5, 1);

INSERT INTO MIEMBRO (cod_miembro, nombre, apellido, edad, residencia, PAIS_cod_pais, PROFESION_cod_profesion) 
VALUES(6, 'Jeuel','Villalpando',31, 'Acuña de Figeroa 6106 80101 Playa Pascual', 3, 5);



INSERT INTO DISCIPLINA VALUES(1, 'Atletismo', 'Saltos de longitud y triples, de altura y con pértiga o garrocha; las pruebas de lanzamiento de martillo, jabalina y disco.');
INSERT INTO DISCIPLINA VALUES(2, 'Bádminton', NULL);
INSERT INTO DISCIPLINA VALUES(3, 'Ciclismo', NULL);
INSERT INTO DISCIPLINA VALUES(4, 'Judo', 'Es un arte marcial que se originó en Japón alrededor de 1880');
INSERT INTO DISCIPLINA VALUES(5, 'Lucha', NULL);
INSERT INTO DISCIPLINA VALUES(6, 'Tenis de Mesa', NULL);
INSERT INTO DISCIPLINA VALUES(7, 'Boxeo', NULL);
INSERT INTO DISCIPLINA VALUES(8, 'Natación', 'Está presente como deporte en los Juegos desde la primera edición de la era moderna, en Atenas, Grecia, en 1896, donde se disputo en aguas abiertas.');
INSERT INTO DISCIPLINA VALUES(9, 'Esgrima', NULL);
INSERT INTO DISCIPLINA VALUES(10, 'Vela', NULL);


INSERT INTO TIPO_MEDALLA VALUES(1, 'Oro');
INSERT INTO TIPO_MEDALLA VALUES(2, 'Plata');
INSERT INTO TIPO_MEDALLA VALUES(3, 'Bronce');
INSERT INTO TIPO_MEDALLA VALUES(4, 'Platino');


INSERT INTO CATEGORIA VALUES(1, 'Clasificatorio');
INSERT INTO CATEGORIA VALUES(2, 'Eliminatorio');
INSERT INTO CATEGORIA VALUES(3, 'Final');


INSERT INTO TIPO_PARTICIPACION VALUES(1, 'Individual');
INSERT INTO TIPO_PARTICIPACION VALUES(2, 'Parejas');
INSERT INTO TIPO_PARTICIPACION VALUES(3, 'Equipos');


INSERT INTO MEDALLERO VALUES(5, 3, 1);
INSERT INTO MEDALLERO VALUES(2, 5, 1);
INSERT INTO MEDALLERO VALUES(6, 4, 3);
INSERT INTO MEDALLERO VALUES(4, 3, 4);
INSERT INTO MEDALLERO VALUES(7, 10, 3);
INSERT INTO MEDALLERO VALUES(3, 8, 2);
INSERT INTO MEDALLERO VALUES(1, 2, 1);
INSERT INTO MEDALLERO VALUES(1, 5, 4);
INSERT INTO MEDALLERO VALUES(5, 7, 2);


INSERT INTO SEDE VALUES(1, 'Gimnasio Metropolitano de Tokio');
INSERT INTO SEDE VALUES(2, 'Jardín del Palacio Imperial de Tokio');
INSERT INTO SEDE VALUES(3, 'Gimnasio Nacional Yoyogi');
INSERT INTO SEDE VALUES(4, 'Nippon Budokan');
INSERT INTO SEDE VALUES(5, 'Estadio Olímpico');



INSERT INTO EVENTO (cod_evento, fecha_hora,ubicacion,DISCIPLINA_cod_disciplina,TIPO_PARTICIPACION_cod_participacion,CATEGORIA_cod_categoria) 
VALUES (1,'2020-07-24 11:00:00',3,2,2,1);

INSERT INTO EVENTO (cod_evento, fecha_hora,ubicacion,DISCIPLINA_cod_disciplina,TIPO_PARTICIPACION_cod_participacion,CATEGORIA_cod_categoria)
VALUES (2,'2020-07-26 10:30:00',1,6,1,3);

INSERT INTO EVENTO (cod_evento, fecha_hora,ubicacion,DISCIPLINA_cod_disciplina,TIPO_PARTICIPACION_cod_participacion,CATEGORIA_cod_categoria)
VALUES (3,'2020-07-30 18:45:00',5,7,1,2);

INSERT INTO EVENTO (cod_evento, fecha_hora,ubicacion,DISCIPLINA_cod_disciplina,TIPO_PARTICIPACION_cod_participacion,CATEGORIA_cod_categoria) 
VALUES (4,'2020-08-01 12:15:00',2,1,1,1);

INSERT INTO EVENTO (cod_evento, fecha_hora,ubicacion,DISCIPLINA_cod_disciplina,TIPO_PARTICIPACION_cod_participacion,CATEGORIA_cod_categoria) 
VALUES (5,'2020-08-08 19:35:00',4,10,3,1);

/*
INCISO 7
*/
ALTER TABLE PAIS
    DROP CONSTRAINT PAIS_unique_nombre;
ALTER TABLE TIPO_MEDALLA
    DROP CONSTRAINT TIPO_MEDALLA_unique_medalla;
ALTER TABLE DEPARTAMENTO
    DROP CONSTRAINT DEPARTAMENTO_unique_nombre;

/*
INCISO 8
*/
ALTER TABLE ATLETA
    DROP CONSTRAINT ATLETA_FK_disciplina;
ALTER TABLE ATLETA
    DROP COLUMN DISCIPLINA_cod_disciplina;

CREATE TABLE DISCIPLINA_ATLETA(
    ATLETA_cod_atleta INTEGER NOT NULL,
    DISCIPLINA_cod_disciplina INTEGER NOT NULL,
    CONSTRAINT PK_DISCIPLINA_ATLETA PRIMARY KEY (ATLETA_cod_atleta, DISCIPLINA_cod_disciplina),
    CONSTRAINT DISCIPLINA_ATLETA_FK_atleta FOREIGN KEY (ATLETA_cod_atleta) REFERENCES ATLETA(cod_atleta) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT DISCIPLINA_ATLETA_FK_disciplina FOREIGN KEY (DISCIPLINA_cod_disciplina) REFERENCES DISCIPLINA(cod_disciplina) ON DELETE CASCADE ON UPDATE CASCADE
);

/*
INCISO 9
*/
ALTER TABLE COSTO_EVENTO
    ALTER COLUMN tarifa SET DATA TYPE NUMERIC(5, 2);

/*
INCISO 10
*/
DELETE FROM TIPO_MEDALLA
WHERE cod_tipo=4;

/*
INCISO 11
*/
DROP TABLE COSTO_EVENTO;
DROP TABLE TELEVISORA;

/*
INCISO 12
*/
DELETE FROM DISCIPLINA;

/*
INCISO 13
*/
UPDATE MIEMBRO
SET telefono = 55464601
WHERE nombre='Laura' AND apellido='Cunha Silva';

UPDATE MIEMBRO
SET telefono = 91514243
WHERE nombre='Jeuel' AND apellido='Villalpando';

UPDATE MIEMBRO
SET telefono = 920686670
WHERE nombre='Scott' AND apellido='Mitchell';

/*
INCISO 14
*/
ALTER TABLE ATLETA
    ADD Fotografia BYTEA NULL;

/*
INCISO 15
*/
ALTER TABLE ATLETA ADD CONSTRAINT check_edad 
CHECK (edad < 25);